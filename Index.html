<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emotional Companion - Your Study Support Friend</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const EmotionalCompanionApp = () => {
          const [currentView, setCurrentView] = useState('chat');
          const [messages, setMessages] = useState([]);
          const [inputText, setInputText] = useState('');
          const [moodHistory, setMoodHistory] = useState([]);
          const [userName, setUserName] = useState('');
          const [showWelcome, setShowWelcome] = useState(true);
          const [isTyping, setIsTyping] = useState(false);
          const [conversationHistory, setConversationHistory] = useState([]);
          const messagesEndRef = useRef(null);

          const SYSTEM_PROMPT = `You are a warm, empathetic emotional companion and study support assistant for students (ages 13-25). Your role is to provide emotional support, encouragement, and gentle guidance - NOT clinical diagnosis or therapy.

        CORE PRINCIPLES:
        - Always respond with empathy first, advice second
        - Use a warm, friendly tone like a supportive friend + mentor
        - Keep responses conversational and natural (2-4 sentences usually)
        - Validate emotions before offering solutions
        - Never shame, pressure, or guilt-trip
        - Respect user autonomy
        - Encourage reflection and positive habits

        SAFETY PROTOCOLS - CRITICAL:
        If user mentions self-harm, suicide, or extreme distress:
        1. Respond with deep empathy and concern
        2. Encourage reaching out to trusted people
        3. Provide crisis resources:
           - National Suicide Prevention Lifeline: 988
           - Crisis Text Line: Text HOME to 741741
        4. Do NOT continue normal coaching flow

        RESPONSE STYLE:
        - Start with validation ("That sounds really hard" / "I hear you")
        - Normalize the feeling when appropriate
        - Offer small, actionable steps (not overwhelming advice)
        - Ask gentle, open-ended questions
        - Avoid toxic positivity
        - Use occasional emojis naturally (not excessively)

        TOPIC AREAS:
        - Exam stress & study pressure
        - Motivation & procrastination
        - Anxiety & overwhelm
        - Low mood & sadness
        - Focus & productivity
        - Burnout & exhaustion
        - Academic self-doubt

        Remember: You're a companion, not a therapist. Build trust through consistency and genuine care.`;

          useEffect(() => {
            const saved = localStorage.getItem('companionData');
            if (saved) {
              const data = JSON.parse(saved);
              setMessages(data.messages || []);
              setMoodHistory(data.moodHistory || []);
              setUserName(data.userName || '');
              setConversationHistory(data.conversationHistory || []);
              setShowWelcome(false);
            }
          }, []);

          useEffect(() => {
            if (!showWelcome) {
              localStorage.setItem('companionData', JSON.stringify({
                messages,
                moodHistory,
                userName,
                conversationHistory
              }));
            }
          }, [messages, moodHistory, userName, conversationHistory, showWelcome]);

          useEffect(() => {
            messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
          }, [messages]);

          const callClaudeAPI = async (userMessage) => {
            try {
              const apiMessages = [
                ...conversationHistory,
                { role: "user", content: userMessage }
              ];

              const response = await fetch("https://api.anthropic.com/v1/messages", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  model: "claude-sonnet-4-20250514",
                  max_tokens: 1000,
                  system: SYSTEM_PROMPT,
                  messages: apiMessages
                })
              });

              const data = await response.json();
              
              if (data.content && data.content[0]) {
                const aiResponse = data.content[0].text;
                
                setConversationHistory(prev => [
                  ...prev,
                  { role: "user", content: userMessage },
                  { role: "assistant", content: aiResponse }
                ]);

                return aiResponse;
              } else {
                throw new Error("Invalid response from API");
              }
            } catch (error) {
              console.error("AI Error:", error);
              return "I'm having trouble connecting right now, but I'm still here with you. Could you try again? If this keeps happening, maybe take a moment to breathe - sometimes tech issues are the universe telling us to pause. üíô";
            }
          };

          const handleQuickAction = async (action) => {
            const prompts = {
              overwhelmed: "I'm feeling really overwhelmed right now. Everything feels like too much.",
              focus: "I'm having trouble focusing on my studies. My mind keeps wandering.",
              low: "I'm feeling really low and sad today. I don't know why exactly.",
              cheer: "I could really use some cheering up right now. Things have been hard.",
              calm: "I need help calming down. I'm feeling anxious and my heart is racing."
            };

            const userMsg = {
              role: 'user',
              content: prompts[action],
              timestamp: new Date().toISOString()
            };

            setMessages(prev => [...prev, userMsg]);
            setIsTyping(true);

            const aiResponse = await callClaudeAPI(prompts[action]);

            const aiMsg = {
              role: 'assistant',
              content: aiResponse,
              timestamp: new Date().toISOString()
            };

            setMessages(prev => [...prev, aiMsg]);
            setIsTyping(false);
          };

          const sendMessage = async () => {
            if (!inputText.trim()) return;

            const userMsg = {
              role: 'user',
              content: inputText,
              timestamp: new Date().toISOString()
            };

            setMessages(prev => [...prev, userMsg]);
            const messageToSend = inputText;
            setInputText('');
            setIsTyping(true);

            const aiResponse = await callClaudeAPI(messageToSend);

            const aiMsg = {
              role: 'assistant',
              content: aiResponse,
              timestamp: new Date().toISOString()
            };

            setMessages(prev => [...prev, aiMsg]);
            setIsTyping(false);
          };

          const submitMoodCheckIn = async (mood, note) => {
            const entry = {
              mood,
              note,
              date: new Date().toISOString(),
              timestamp: Date.now()
            };
            setMoodHistory(prev => [...prev, entry]);
            
            setIsTyping(true);
            
            const moodMessages = {
              great: "I just checked in with my mood and I'm feeling great today!",
              okay: "I checked in with my mood - I'm feeling okay today, nothing special.",
              struggling: "I'm checking in... I'm struggling a bit today.",
              bad: "I'm checking in and honestly, I'm feeling really bad today."
            };

            const aiResponse = await callClaudeAPI(moodMessages[mood]);

            const encouragement = {
              role: 'assistant',
              content: aiResponse,
              timestamp: new Date().toISOString()
            };
            
            setMessages(prev => [...prev, encouragement]);
            setIsTyping(false);
            setCurrentView('chat');
          };

          const handleWelcomeSubmit = async (name) => {
            setUserName(name);
            setShowWelcome(false);
            setIsTyping(true);

            const welcomePrompt = `Hi, my name is ${name}. I'm new here and could use some emotional support.`;
            const aiResponse = await callClaudeAPI(welcomePrompt);

            const welcomeMsg = {
              role: 'assistant',
              content: aiResponse,
              timestamp: new Date().toISOString()
            };
            
            setMessages([welcomeMsg]);
            setIsTyping(false);
          };

          // SVG Icons as components
          const HeartIcon = () => (
            <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
            </svg>
          );

          const MessageIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
            </svg>
          );

          const TrendingIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
            </svg>
          );

          const SendIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
            </svg>
          );

          const AlertIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            </svg>
          );

          if (showWelcome) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-pink-50 flex items-center justify-center p-4">
                <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full">
                  <div className="text-center mb-6">
                    <div className="w-20 h-20 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full mx-auto mb-4 flex items-center justify-center">
                      <HeartIcon />
                    </div>
                    <h1 className="text-3xl font-bold text-gray-800 mb-2">Welcome</h1>
                    <p className="text-gray-600">Your safe space for emotional support & study help</p>
                  </div>
                  
                  <div className="space-y-4">
                    <input
                      type="text"
                      placeholder="What should I call you?"
                      className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-400 focus:outline-none"
                      onKeyPress={(e) => e.key === 'Enter' && e.target.value && handleWelcomeSubmit(e.target.value)}
                    />
                    <button
                      onClick={(e) => {
                        const input = e.target.previousElementSibling;
                        if (input.value) handleWelcomeSubmit(input.value);
                      }}
                      className="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-xl font-semibold hover:shadow-lg transition-all"
                    >
                      Let's Start
                    </button>
                  </div>

                  <div className="mt-6 p-4 bg-blue-50 rounded-xl text-sm text-gray-600">
                    <p className="font-semibold mb-2">üîí Your Privacy Matters</p>
                    <p>All conversations are stored locally on your device. I'm here to support you, not diagnose or replace professional help.</p>
                  </div>

                  <div className="mt-4 p-4 bg-purple-50 rounded-xl text-sm text-gray-600">
                    <p className="font-semibold mb-2 flex items-center"><AlertIcon /><span className="ml-2">Powered by AI</span></p>
                    <p>This app uses Claude AI to provide personalized, empathetic responses to your unique situation.</p>
                  </div>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-pink-50">
              <div className="bg-white shadow-sm border-b border-gray-200">
                <div className="max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
                  <div className="flex items-center space-x-3">
                    <div className="w-10 h-10 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full flex items-center justify-center">
                      <HeartIcon />
                    </div>
                    <div>
                      <h1 className="font-bold text-gray-800">Your AI Companion</h1>
                      <p className="text-xs text-gray-500">Here for you, {userName}</p>
                    </div>
                  </div>
                  
                  <div className="flex space-x-2">
                    <button
                      onClick={() => setCurrentView('chat')}
                      className={`p-2 rounded-lg transition-all ${currentView === 'chat' ? 'bg-purple-100 text-purple-600' : 'text-gray-400 hover:bg-gray-100'}`}
                    >
                      <MessageIcon />
                    </button>
                    <button
                      onClick={() => setCurrentView('checkin')}
                      className={`p-2 rounded-lg transition-all ${currentView === 'checkin' ? 'bg-purple-100 text-purple-600' : 'text-gray-400 hover:bg-gray-100'}`}
                    >
                      <HeartIcon />
                    </button>
                    <button
                      onClick={() => setCurrentView('trends')}
                      className={`p-2 rounded-lg transition-all ${currentView === 'trends' ? 'bg-purple-100 text-purple-600' : 'text-gray-400 hover:bg-gray-100'}`}
                    >
                      <TrendingIcon />
                    </button>
                  </div>
                </div>
              </div>

              <div className="max-w-4xl mx-auto p-4 h-[calc(100vh-80px)] flex flex-col">
                {currentView === 'chat' && (
                  <>
                    <div className="mb-4 flex flex-wrap gap-2">
                      <button onClick={() => handleQuickAction('overwhelmed')} className="px-4 py-2 bg-white rounded-full text-sm text-gray-700 hover:bg-purple-50 border border-gray-200 transition-all">
                        üò∞ I feel overwhelmed
                      </button>
                      <button onClick={() => handleQuickAction('focus')} className="px-4 py-2 bg-white rounded-full text-sm text-gray-700 hover:bg-purple-50 border border-gray-200 transition-all">
                        üéØ I can't focus
                      </button>
                      <button onClick={() => handleQuickAction('low')} className="px-4 py-2 bg-white rounded-full text-sm text-gray-700 hover:bg-purple-50 border border-gray-200 transition-all">
                        üòî I feel low
                      </button>
                      <button onClick={() => handleQuickAction('cheer')} className="px-4 py-2 bg-white rounded-full text-sm text-gray-700 hover:bg-purple-50 border border-gray-200 transition-all">
                        ‚ú® Cheer me up
                      </button>
                      <button onClick={() => handleQuickAction('calm')} className="px-4 py-2 bg-white rounded-full text-sm text-gray-700 hover:bg-purple-50 border border-gray-200 transition-all">
                        üåä Help me calm down
                      </button>
                    </div>

                    <div className="flex-1 overflow-y-auto space-y-4 mb-4">
                      {messages.map((msg, idx) => (
                        <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                          <div className={`max-w-[80%] p-4 rounded-2xl ${
                            msg.role === 'user' 
                              ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white' 
                              : 'bg-white text-gray-800 shadow-sm border border-gray-100'
                          }`}>
                            <p className="whitespace-pre-wrap">{msg.content}</p>
                          </div>
                        </div>
                      ))}
                      {isTyping && (
                        <div className="flex justify-start">
                          <div className="bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
                            <div className="flex space-x-2">
                              <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                              <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div>
                              <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{animationDelay: '0.4s'}}></div>
                            </div>
                          </div>
                        </div>
                      )}
                      <div ref={messagesEndRef} />
                    </div>

                    <div className="flex space-x-2">
                      <input
                        type="text"
                        value={inputText}
                        onChange={(e) => setInputText(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                        placeholder="Share what's on your mind..."
                        className="flex-1 px-4 py-3 bg-white border-2 border-gray-200 rounded-2xl focus:border-purple-400 focus:outline-none"
                      />
                      <button
                        onClick={sendMessage}
                        disabled={isTyping}
                        className={`px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-2xl hover:shadow-lg transition-all ${isTyping ? 'opacity-50 cursor-not-allowed' : ''}`}
                      >
                        <SendIcon />
                      </button>
                    </div>
                  </>
                )}

                {currentView === 'checkin' && (
                  <div className="bg-white rounded-3xl shadow-xl p-8 max-w-md mx-auto">
                    <h2 className="text-2xl font-bold text-gray-800 mb-6 text-center">How are you feeling today?</h2>
                    
                    <div className="space-y-4">
                      {[
                        { mood: 'great', emoji: 'üòä', label: 'Great', color: 'from-green-400 to-emerald-500' },
                        { mood: 'okay', emoji: 'üòê', label: 'Okay', color: 'from-yellow-400 to-orange-400' },
                        { mood: 'struggling', emoji: 'üòî', label: 'Struggling', color: 'from-blue-400 to-indigo-500' },
                        { mood: 'bad', emoji: 'üò¢', label: 'Really Bad', color: 'from-purple-400 to-pink-500' }
                      ].map(({ mood, emoji, label, color }) => (
                        <button
                          key={mood}
                          onClick={() => submitMoodCheckIn(mood, '')}
                          disabled={isTyping}
                          className={`w-full p-4 rounded-xl bg-gradient-to-r ${color} text-white font-semibold hover:shadow-lg transition-all flex items-center justify-between ${isTyping ? 'opacity-50 cursor-not-allowed' : ''}`}
                        >
                          <span className="text-2xl">{emoji}</span>
                          <span>{label}</span>
                          <span className="opacity-0">‚Üí</span>
                        </button>
                      ))}
                    </div>

                    <p className="text-center text-sm text-gray-500 mt-6">Your check-ins help track your emotional patterns over time</p>
                  </div>
                )}

                {currentView === 'trends' && (
                  <div className="bg-white rounded-3xl shadow-xl p-8">
                    <h2 className="text-2xl font-bold text-gray-800 mb-6">Your Mood Journey</h2>
                    
                    {moodHistory.length === 0 ? (
                      <div className="text-center py-12">
                        <TrendingIcon />
                        <p className="text-gray-500 mt-4">Start checking in daily to see your mood patterns</p>
                      </div>
                    ) : (
                      <div className="space-y-4">
                        <div className="grid grid-cols-4 gap-4 mb-6">
                          {['üòä', 'üòê', 'üòî', 'üò¢'].map((emoji, idx) => {
                            const count = moodHistory.filter(h => 
                              ['great', 'okay', 'struggling', 'bad'][idx] === h.mood
                            ).length;
                            return (
                              <div key={idx} className="text-center p-4 bg-gray-50 rounded-xl">
                                <div className="text-3xl mb-2">{emoji}</div>
                                <div className="text-2xl font-bold text-gray-800">{count}</div>
                                <div className="text-xs text-gray-500">times</div>
                              </div>
                            );
                          })}
                        </div>

                        <h3 className="font-semibold text-gray-700 mb-3">Recent Check-ins</h3>
                        <div className="space-y-2 max-h-64 overflow-y-auto">
                          {moodHistory.slice().reverse().slice(0, 10).map((entry, idx) => (
                            <div key={idx} className="p-3 bg-gray-50 rounded-lg flex items-center justify-between">
                              <div className="flex items-center space-x-3">
                                <span className="text-2xl">
                                  {entry.mood === 'great' ? 'üòä' : entry.mood === 'okay' ? 'üòê' : entry.mood === 'struggling' ? 'üòî' : 'üò¢'}
                                </span>
                                <span className="text-sm text-gray-600">
                                  {new Date(entry.date).toLocaleDateString()}
                                </span>
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>
                    )}
                  </div>
                )}
              </div>
            </div>
          );
        };

        ReactDOM.render(<EmotionalCompanionApp />, document.getElementById('root'));
    </script>
</body>
</html>